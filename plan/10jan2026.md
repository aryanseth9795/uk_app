

we have to revamp our home screen , for now we have static banner , now it will fetched by apis , in api response we have banner detail array , we have to normalise the response first , like we have [ {

    title:"top",
    child:2,
    image:[ array of image link used in carosel],
    
}   ]

so we have allocate banner according to title - so we have three - title- TOP, MIDDLE, BOTTOM. 

IF TOP then child then we have to show on top after header and in sequence like top child 1 then top child 2 then top child 3 .

similarly after ending of categories section we have to show MIDDLE and after ending of mixed products we have to show bottom banner.


also banner have multiple images so we have to show carosel of images. and when it is one then show as banner display , so apply carosel conditionally.

lastly we have to make this app - OTA expo update ready .

here is the api doc
# User Banner API Documentation

Public endpoints for fetching banners. No authentication required.

---

## Base URL

```
/api/user/banners
```

---

## Endpoints

### 1. Get All Active Banners

Retrieve all active banners with Redis caching (1-hour TTL).

**Endpoint:** `GET /api/user/banners`

**Authentication:** Not required

**Response (200 OK):**

```json
{
  "success": true,
  "banners": [
    {
      "_id": "677f8a5b3c4e1a2b3c4d5e6f",
      "title": "top",
      "child": 1,
      "images": [
        {
          "publicId": "urs/banners/abc123",
          "url": "http://res.cloudinary.com/...",
          "secureUrl": "https://res.cloudinary.com/..."
        }
      ]
    },
    {
      "_id": "677f8a5b3c4e1a2b3c4d5e70",
      "title": "top",
      "child": 2,
      "images": [
        {
          "publicId": "urs/banners/def456",
          "url": "http://res.cloudinary.com/...",
          "secureUrl": "https://res.cloudinary.com/..."
        }
      ]
    },
    {
      "_id": "677f8a5b3c4e1a2b3c4d5e71",
      "title": "bottom",
      "images": [
        {
          "publicId": "urs/banners/ghi789",
          "url": "http://res.cloudinary.com/...",
          "secureUrl": "https://res.cloudinary.com/..."
        }
      ]
    }
  ]
}
```

**Notes:**

- Only returns banners where `isActive: true`
- Sorted by `createdAt` (newest first)
- Selected fields: `title`, `child`, `images`
- Cached for 1 hour (subsequent requests served from Redis)

---

### 2. Get Banner by Title

Retrieve a specific active banner by its title.

**Endpoint:** `GET /api/user/banners/:title`

**Authentication:** Not required

**Path Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `title` | string | Yes | Banner title (case-insensitive, e.g., "TOP", "BOTTOM") |

**Example Request:**

```bash
GET /api/user/banners/top
GET /api/user/banners/BOTTOM
```

**Success Response (200 OK):**

```json
{
  "success": true,
  "banner": {
    "_id": "677f8a5b3c4e1a2b3c4d5e6f",
    "title": "top",
    "child": 1,
    "images": [
      {
        "publicId": "urs/banners/abc123",
        "url": "http://res.cloudinary.com/...",
        "secureUrl": "https://res.cloudinary.com/..."
      }
    ]
  }
}
```

**Error Responses:**

**400 Bad Request** - Missing or empty title:

```json
{
  "success": false,
  "message": "Title is required"
}
```

**404 Not Found** - Banner not found or not active:

```json
{
  "success": false,
  "message": "Banner not found"
}
```

**Notes:**

- Title search is case-insensitive (automatically converted to lowercase)
- Only returns banners where `isActive: true`
- Cached for 1 hour

---

## Response Fields

### Banner Object

```typescript
{
  _id: string;              // MongoDB ObjectId
  title: string;            // Banner title (lowercase)
  child?: number;           // Optional child number (e.g., 1, 2, 3)
  images: Image[];          // Array of image objects
}
```

### Image Object

```typescript
{
  publicId: string; // Cloudinary public ID
  url: string; // HTTP URL
  secureUrl: string; // HTTPS URL (recommended for production)
}
```

---

## Frontend Integration

### React/React Native Example

```javascript
import { useState, useEffect } from "react";

// Fetch all banners
export const useBanners = () => {
  const [banners, setBanners] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetch("https://api.example.com/api/user/banners")
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          // Format child display for UI
          const formatted = data.banners.map((banner) => ({
            ...banner,
            displayName: banner.child
              ? `${banner.title.toUpperCase()} child-${banner.child}`
              : banner.title.toUpperCase(),
          }));
          setBanners(formatted);
        } else {
          setError(data.message);
        }
      })
      .catch((err) => setError(err.message))
      .finally(() => setLoading(false));
  }, []);

  return { banners, loading, error };
};

// Fetch specific banner by title
export const useBannerByTitle = (title: string) => {
  const [banner, setBanner] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (!title) return;

    fetch(
      `https://api.example.com/api/user/banners/${encodeURIComponent(title)}`
    )
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          setBanner(data.banner);
        } else {
          setError(data.message);
        }
      })
      .catch((err) => setError(err.message))
      .finally(() => setLoading(false));
  }, [title]);

  return { banner, loading, error };
};
```

### Usage Example

```jsx
function BannerCarousel() {
  const { banners, loading, error } = useBanners();

  if (loading) return <Spinner />;
  if (error) return <Error message={error} />;

  return (
    <Carousel>
      {banners.map((banner) => (
        <BannerSlide
          key={banner._id}
          title={banner.displayName}
          image={banner.images[0]?.secureUrl}
        />
      ))}
    </Carousel>
  );
}

function SpecificBanner() {
  const { banner, loading, error } = useBannerByTitle("TOP");

  if (loading) return <Spinner />;
  if (error) return <Error message={error} />;
  if (!banner) return null;

  return <Image src={banner.images[0]?.secureUrl} alt={banner.title} />;
}
```

---

## Caching Behavior

### Cache Configuration

- **TTL**: 3600 seconds (1 hour)
- **Cache Key Prefix**: `user:banners`
- **Cache Keys**:
  - All banners: `user:banners:/`
  - By title: `user:banners:/:title=<title>`

### Cache Flow

**First Request:**

```
Client → API → Check Redis → Miss → Database Query → Store in Redis → Return
```

**Subsequent Requests (within 1 hour):**

```
Client → API → Check Redis → Hit → Return from Cache (fast!)
```

### Cache Invalidation

Cache is automatically cleared when admins:

- Create a new banner
- Update an existing banner
- Delete a banner

After invalidation, the next request fetches fresh data from the database.

---

## Child Field Formatting

Banners can have an optional `child` number for grouping:

**Backend stores:**

```json
{ "title": "top", "child": 1 }
{ "title": "top", "child": 2 }
{ "title": "bottom" }
```


---


---
